/* 激光测距 V6 */ /* 硬件版本：OPA842放大倍数2 */
/* UC-OSII版本 */
/* 主控任务、测量生产数据任务、处理数据任务、AGC任务 校准调试任务 */
/* 采用消息队列通信 */
/* 使用TDC-GPX2时间测量芯片 */
/* 多阈值拟合校准 */
/* 自动增益控制(AGC) */
/* 脉冲峰值采集 ADC+DMA */
/* 大小目标检测切换 */
/* 优化排序，使用快速排序算法 */
/* date:2020.05.22 Emil: hdu_tangguodong@163.com */

/* 让阈值时间差跟随距离，不再单独对阈值时间差做滤波，保证阈值时间差和输出距离唯一对应 */
/* 提供最后对结果缓冲区内数据两种处理方式，平均和中值，通过宏定义ARGV选择 */
/* 最后再来转double,之前都用time_ps来处理数据，减小精度损失 */
/* 设置调试校准任务 */
/* date:2020.05.24 Emil: hdu_tangguodong@163.com */

/* 930~940 GAIN 1V/V */
/* 135米 1.6V */
/* 多阈值拟合策略: 仅使用err_time3(Vth3 - Vth1) */
/* 0<err_time3<=1120 err = 2.71 */
/* 1120<err_time3<2000  err = -3.019+0.8541*ln(-10.9372*err_time3+11430) */
/* err_time>2000  err = 0.0004*err_time3+4.0737 */
/* todo : 上升沿跳变点。峰值2V以上，err_time3 峰值2V以下，err_time1 */
/* date:2020.05.25 Emil: hdu_tangguodong@163.com */

/* 增加侦察阈值，负责探测是否有有用信号返回，当干扰脉冲大于信号脉冲时能够提高测距能力 */
/* 测试：测大目标基本稳定，测线（只测了26米以内）跳动1~2米，猜测是增益太大，干扰脉冲叠加 */
/* todo: 确定测线问题原因，必要时需减小前级增益，打开AGC_LOW功能（可能会让近距离大目标不准） */
/* date:2020.05.26 Emil: hdu_tangguodong@163.com */

/* 经测试，对于不同反射目标，阈值时间差有不同的误差，特别是近距离阈值时间差 */
/* 这个要解决有点恼火，软件上貌似无能为力，改善硬件或许是唯一的办法 */
/* date:2020.05.29 Emil: hdu_tangguodong@163.com */

/* 需要对拟合曲线不线性区域进行优化（暂时还没方法） */
/* 增加自动档位切换模式代替基于脉冲峰值的AGC模式 实测发现测得更远了 最远稳定测到1030米 */
/* date:2020.06.05 Emil: hdu_tangguodong@163.com */

/* 针对近距离截止失真后阈值时间差跳动到非线性区域导致修正误差过大，*/
/* 在小于某一个距离时跳过阈值时间差落入非线性区域（1200~1500）的数据 */
/* date:2020.06.09 Emil: hdu_tangguodong@163.com */

/* author @ tangtang  Emil: hdu_tangguodong@163.com */
/* 杭州电子科技大学 */
